<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Global.vr</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>Global.vr</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="nx">Using</span> <span class="nx">System</span>
<span class="nx">Using</span> <span class="nx">System</span><span class="p">.</span><span class="nx">Web</span><span class="p">.</span><span class="nx">Routing</span>
<span class="nx">Using</span> <span class="nx">ASNA</span><span class="p">.</span><span class="nx">JsonRestRouting</span>
<span class="nx">Using</span> <span class="nx">System</span><span class="p">.</span><span class="nx">Web</span>
<span class="nx">Using</span> <span class="nx">System</span><span class="p">.</span><span class="nx">Web</span><span class="p">.</span><span class="nx">Security</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>/ <summary>
/ Summary description for Global
/ </summary></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">BegClass</span> <span class="nx">Global</span> <span class="nx">Access</span><span class="p">(</span><span class="o">*</span><span class="nx">Public</span><span class="p">)</span> <span class="nx">Extends</span><span class="p">(</span><span class="nx">System</span><span class="p">.</span><span class="nx">Web</span><span class="p">.</span><span class="nx">HttpApplication</span><span class="p">)</span>

	<span class="nx">BegSr</span> <span class="nx">Application_Start</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Code that runs on application startup</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">RegisterRoutes</span><span class="p">(</span><span class="nx">RouteTable</span><span class="p">.</span><span class="nx">Routes</span><span class="p">)</span>
	<span class="nx">EndSr</span>

	<span class="nx">BegSr</span> <span class="nx">Application_End</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Code that runs on application shutdown</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="nx">EndSr</span>
        

	<span class="nx">BegSr</span> <span class="nx">Application_BeginRequest</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span>

		<span class="nx">DclFld</span> <span class="nx">context</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">HttpApplication</span><span class="p">)</span>
		<span class="nx">context</span> <span class="o">=</span> <span class="nx">sender</span> <span class="o">*</span><span class="nx">As</span> <span class="nx">HttpApplication</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="nx">DclFLd</span> <span class="nx">t</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Boolean</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <pre><code>t = FormsAuthentication.IsEnabled
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="nx">t</span> <span class="o">=</span> <span class="nx">IsAjaxRequest</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <pre><code>If (FormsAuthentication.IsEnabled AND +
       IsAjaxRequest(context))

    context.Response.SuppressFormsAuthenticationRedirect = *True
EndIf
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="nx">EndSr</span>

	<span class="nx">BegFunc</span> <span class="nx">IsAjaxRequest</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Boolean</span><span class="p">)</span> 
		<span class="nx">DclSrParm</span> <span class="nx">context</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">HttpApplication</span><span class="p">)</span>

		<span class="nx">DclFld</span> <span class="nx">t</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">String</span><span class="p">)</span> 

		<span class="nx">If</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">FilePath</span><span class="p">.</span><span class="nx">StartsWith</span><span class="p">(</span><span class="s1">&#39;/api/&#39;</span><span class="p">)</span> <span class="nx">AND</span> <span class="o">+</span>
		   <span class="nx">context</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">ContentType</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
			<span class="nx">t</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
		<span class="nx">Else</span>
			<span class="nx">t</span> <span class="o">=</span><span class="s1">&#39;t&#39;</span>
		<span class="nx">EndIf</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <pre><code>ForEach key Type(*String) Collection(context.Request.Headers.Keys) 
    t = context.Request[key]
EndFor
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="nx">If</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Headers</span><span class="p">[</span><span class="s1">&#39;x-requested-with&#39;</span><span class="p">]</span> <span class="o">&lt;&gt;</span> <span class="o">*</span><span class="nx">Nothing</span><span class="p">)</span> 		
			<span class="nx">t</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Headers</span><span class="p">[</span><span class="s2">&quot;x-requested-with&quot;</span><span class="p">].</span><span class="nx">ToString</span><span class="p">()</span>
		<span class="nx">EndIf</span> 

		<span class="nx">LeaveSr</span> <span class="o">*</span><span class="nx">True</span>
	<span class="nx">EndFunc</span> 

	<span class="nx">BegSr</span> <span class="nx">Application_EndRequest</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span>

		<span class="nx">DclFld</span> <span class="nx">context</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">HttpApplication</span><span class="p">)</span>
		<span class="nx">context</span> <span class="o">=</span> <span class="nx">sender</span> <span class="o">*</span><span class="nx">As</span> <span class="nx">HttpApplication</span>
	
		<span class="nx">If</span> <span class="p">(</span><span class="nx">FormsAuthentication</span><span class="p">.</span><span class="nx">IsEnabled</span> <span class="nx">AND</span> <span class="o">+</span>
		    <span class="nx">context</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">StatusCode</span> <span class="o">=</span> <span class="mi">302</span> <span class="nx">AND</span> <span class="o">+</span>  
            <span class="nx">IsAjaxRequest</span><span class="p">(</span><span class="nx">context</span><span class="p">))</span>
		
			<span class="nx">context</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">SuppressFormsAuthenticationRedirect</span> <span class="o">=</span> <span class="o">*</span><span class="nx">True</span>
		<span class="nx">EndIf</span>

	<span class="nx">EndSr</span>


	<span class="nx">BegSr</span> <span class="nx">Application_Error</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Code that runs when an unhandled error occurs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="nx">EndSr</span>

	<span class="nx">BegSr</span> <span class="nx">Session_Start</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span>

        <span class="nx">DclFld</span> <span class="nx">ActiveDBNameKey</span>  <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">String</span><span class="p">)</span>
        <span class="nx">DclFld</span> <span class="nx">DBName</span>        <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">String</span><span class="p">)</span> 

        <span class="nx">ActiveDBNameKey</span> <span class="o">=</span> <span class="nx">System</span><span class="p">.</span><span class="nx">Configuration</span><span class="p">.</span><span class="nx">ConfigurationManager</span><span class="p">.</span><span class="nx">AppSettings</span><span class="p">[</span><span class="s2">&quot;ActiveDBName&quot;</span><span class="p">]</span>
        <span class="nx">DBName</span> <span class="o">=</span> <span class="nx">System</span><span class="p">.</span><span class="nx">Configuration</span><span class="p">.</span><span class="nx">ConfigurationManager</span><span class="p">.</span><span class="nx">AppSettings</span><span class="p">[</span><span class="nx">ActiveDBNameKey</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>HTTPContext.Current.Session['dbname'] = DBName</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">Session</span><span class="p">[</span><span class="s1">&#39;dbname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">DBName</span>
	<span class="nx">EndSr</span>

	<span class="nx">BegSr</span> <span class="nx">Session_End</span>
		<span class="nx">DclSrParm</span> <span class="nx">sender</span> <span class="nx">Type</span><span class="p">(</span><span class="o">*</span><span class="nb">Object</span><span class="p">)</span>
		<span class="nx">DclSrParm</span> <span class="nx">e</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">EventArgs</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Code that runs when a session ends. 
Note: The Session_End event is raised only when the sessionstate mode
is set to InProc in the Web.config file. If session mode is set to StateServer 
or SQLServer, the event is not raised.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="nx">EndSr</span>


    <span class="nx">BegSr</span> <span class="nx">RegisterRoutes</span>
        <span class="nx">DclSrParm</span> <span class="nx">routes</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">RouteCollection</span><span class="p">)</span>

        <span class="nx">DclFld</span> <span class="nx">restRouter</span> <span class="nx">Type</span><span class="p">(</span><span class="nx">ASNA</span><span class="p">.</span><span class="nx">JsonRestRouting</span><span class="p">.</span><span class="nx">Router</span><span class="p">)</span> 
        <span class="nx">restRouter</span> <span class="o">=</span> <span class="o">*</span><span class="nx">New</span> <span class="nx">ASNA</span><span class="p">.</span><span class="nx">JsonRestRouting</span><span class="p">.</span><span class="nx">Router</span><span class="p">(</span><span class="nx">routes</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>ASPX page routes.     <br />
This support is provided directly by MS .NET.
     routes.MapPageRoute("", "", "~/views/index.aspx")
     routes.MapPageRoute("", "home", "~/views/index.aspx")
     routes.MapPageRoute("", "workorders", "~/views/CustomerList.aspx")</p>
<pre><code>restRouter.Page("", "/index", "~/views/index.aspx")  
restRouter.Page("", "/workorders", "~/views/customerlist.aspx")
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>RESTful routes.
This suport is provided by the ASNA.JsonRestRouting assembly.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">restRouter</span><span class="p">.</span><span class="nx">Post</span><span class="p">(</span><span class="s2">&quot;api/changestatus&quot;</span><span class="p">,</span> <span class="s2">&quot;ChangeStatusAction&quot;</span><span class="p">,</span> <span class="o">*</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">WorkOrdersController</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <pre><code>   restRouter.Get("api/contact/{id}", "ShowAction", *TypeOf(ContactController))
   restRouter.Post("api/contacts", "CreateAction", *TypeOf(ContactController))
   restRouter.Put("api/contacts/{id}", "UpdateAction", *TypeOf(ContactController))
   restRouter.Delete("api/contacts/{id}", "DeleteAction", *TypeOf(ContactController))
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">EndSr</span>



<span class="nx">EndClass</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
